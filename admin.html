<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ModAPK Admin Panel</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <meta name="theme-color" content="#1FB8CD">
</head>
<body class="admin-body">
    <!-- Admin Navigation -->
    <nav class="admin-nav">
        <div class="admin-nav-container">
            <div class="admin-brand">
                <i class="fas fa-shield-alt"></i>
                <span>ModAPK Admin</span>
            </div>
            
            <div class="admin-nav-menu">
                <button class="admin-nav-item active" onclick="showAdminView('dashboard')">
                    <i class="fas fa-chart-bar"></i>
                    <span>Dashboard</span>
                </button>
                <button class="admin-nav-item" onclick="showAdminView('apks')">
                    <i class="fas fa-mobile-alt"></i>
                    <span>APKs</span>
                </button>
                <button class="admin-nav-item" onclick="showAdminView('categories')">
                    <i class="fas fa-folder"></i>
                    <span>Categories</span>
                </button>
                <button class="admin-nav-item" onclick="showAdminView('users')">
                    <i class="fas fa-users"></i>
                    <span>Users</span>
                </button>
                <button class="admin-nav-item" onclick="showAdminView('ads')">
                    <i class="fas fa-ad"></i>
                    <span>Advertisements</span>
                </button>
                <button class="admin-nav-item" onclick="showAdminView('analytics')">
                    <i class="fas fa-analytics"></i>
                    <span>Analytics</span>
                </button>
                <button class="admin-nav-item" onclick="showAdminView('settings')">
                    <i class="fas fa-cogs"></i>
                    <span>Settings</span>
                </button>
            </div>
            
            <div class="admin-user-menu">
                <span id="admin-username">Admin</span>
                <div class="admin-dropdown">
                    <button onclick="window.open('index.html', '_blank')">
                        <i class="fas fa-external-link-alt"></i> View Site
                    </button>
                    <button onclick="adminLogout()">
                        <i class="fas fa-sign-out-alt"></i> Logout
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <!-- Admin Main Content -->
    <main class="admin-main">
        <!-- Loading Screen -->
        <div id="admin-loading" class="admin-loading">
            <div class="loader">
                <div class="spinner"></div>
                <h3>Loading Admin Panel</h3>
                <p>Connecting to database...</p>
            </div>
        </div>

        <!-- Dashboard View -->
        <div id="dashboard-view" class="admin-view active">
            <div class="admin-header">
                <h1>Dashboard</h1>
                <div class="admin-actions">
                    <button class="btn btn-primary" onclick="showAddAPKModal()">
                        <i class="fas fa-plus"></i> Add New APK
                    </button>
                    <button class="btn btn-secondary" onclick="refreshData()">
                        <i class="fas fa-sync"></i> Refresh
                    </button>
                </div>
            </div>

            <!-- Stats Cards -->
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-mobile-alt"></i>
                    </div>
                    <div class="stat-info">
                        <h3 id="stat-apks">0</h3>
                        <p>Total APKs</p>
                        <span class="stat-change positive" id="apks-change">+0</span>
                    </div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-download"></i>
                    </div>
                    <div class="stat-info">
                        <h3 id="stat-downloads">0</h3>
                        <p>Total Downloads</p>
                        <span class="stat-change positive" id="downloads-change">+0</span>
                    </div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-users"></i>
                    </div>
                    <div class="stat-info">
                        <h3 id="stat-users">0</h3>
                        <p>Total Users</p>
                        <span class="stat-change positive" id="users-change">+0</span>
                    </div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-star"></i>
                    </div>
                    <div class="stat-info">
                        <h3 id="stat-rating">0.0</h3>
                        <p>Avg Rating</p>
                        <span class="stat-change positive" id="rating-change">+0.0</span>
                    </div>
                </div>
            </div>

            <!-- Charts -->
            <div class="charts-grid">
                <div class="chart-card">
                    <h3>Downloads Trend</h3>
                    <canvas id="downloads-chart"></canvas>
                </div>
                <div class="chart-card">
                    <h3>Category Distribution</h3>
                    <canvas id="categories-chart"></canvas>
                </div>
            </div>

            <!-- Recent Activity -->
            <div class="activity-card">
                <h3>Recent Activity</h3>
                <div id="recent-activity">
                    <!-- Activity items will be loaded here -->
                </div>
            </div>
        </div>

        <!-- APKs View -->
        <div id="apks-view" class="admin-view">
            <div class="admin-header">
                <h1>Manage APKs</h1>
                <div class="admin-actions">
                    <button class="btn btn-primary" onclick="showAddAPKModal()">
                        <i class="fas fa-plus"></i> Add New APK
                    </button>
                    <button class="btn btn-secondary" onclick="exportAPKs()">
                        <i class="fas fa-download"></i> Export
                    </button>
                </div>
            </div>

            <!-- Filters -->
            <div class="filters">
                <div class="filter-group">
                    <input type="text" id="apk-search" placeholder="Search APKs..." class="filter-input">
                    <select id="category-filter" class="filter-select">
                        <option value="">All Categories</option>
                    </select>
                    <select id="status-filter" class="filter-select">
                        <option value="">All Status</option>
                        <option value="verified">Verified</option>
                        <option value="featured">Featured</option>
                        <option value="trending">Trending</option>
                    </select>
                </div>
                <div class="bulk-actions">
                    <button class="btn btn-warning" onclick="bulkVerify()">
                        <i class="fas fa-check"></i> Bulk Verify
                    </button>
                    <button class="btn btn-danger" onclick="bulkDelete()">
                        <i class="fas fa-trash"></i> Bulk Delete
                    </button>
                </div>
            </div>

            <!-- APKs Table -->
            <div class="table-container">
                <table class="admin-table">
                    <thead>
                        <tr>
                            <th><input type="checkbox" id="select-all-apks"></th>
                            <th>Icon</th>
                            <th>Name</th>
                            <th>Version</th>
                            <th>Category</th>
                            <th>Downloads</th>
                            <th>Rating</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="apks-table-body">
                        <!-- APK rows will be loaded here -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Categories View -->
        <div id="categories-view" class="admin-view">
            <div class="admin-header">
                <h1>Manage Categories</h1>
                <div class="admin-actions">
                    <button class="btn btn-primary" onclick="showAddCategoryModal()">
                        <i class="fas fa-plus"></i> Add Category
                    </button>
                </div>
            </div>

            <div class="table-container">
                <table class="admin-table">
                    <thead>
                        <tr>
                            <th>Icon</th>
                            <th>Name</th>
                            <th>Description</th>
                            <th>Color</th>
                            <th>APKs Count</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="categories-table-body">
                        <!-- Category rows will be loaded here -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Users View -->
        <div id="users-view" class="admin-view">
            <div class="admin-header">
                <h1>Manage Users</h1>
                <div class="admin-actions">
                    <button class="btn btn-secondary" onclick="exportUsers()">
                        <i class="fas fa-download"></i> Export Users
                    </button>
                </div>
            </div>

            <div class="table-container">
                <table class="admin-table">
                    <thead>
                        <tr>
                            <th>Avatar</th>
                            <th>Username</th>
                            <th>Email</th>
                            <th>Role</th>
                            <th>Joined</th>
                            <th>Last Login</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="users-table-body">
                        <!-- User rows will be loaded here -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Advertisements View -->
        <div id="ads-view" class="admin-view">
            <div class="admin-header">
                <h1>Manage Advertisements</h1>
                <div class="admin-actions">
                    <button class="btn btn-primary" onclick="showAddAdModal()">
                        <i class="fas fa-plus"></i> Create Ad
                    </button>
                </div>
            </div>

            <!-- Ad Statistics -->
            <div class="ad-stats">
                <div class="ad-stat-card">
                    <h3 id="total-ads">0</h3>
                    <p>Total Ads</p>
                </div>
                <div class="ad-stat-card">
                    <h3 id="active-ads">0</h3>
                    <p>Active Ads</p>
                </div>
                <div class="ad-stat-card">
                    <h3 id="ad-impressions">0</h3>
                    <p>Impressions</p>
                </div>
                <div class="ad-stat-card">
                    <h3 id="ad-clicks">0</h3>
                    <p>Clicks</p>
                </div>
            </div>

            <div class="table-container">
                <table class="admin-table">
                    <thead>
                        <tr>
                            <th>Title</th>
                            <th>Position</th>
                            <th>Status</th>
                            <th>Impressions</th>
                            <th>Clicks</th>
                            <th>CTR</th>
                            <th>Created</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="ads-table-body">
                        <!-- Ad rows will be loaded here -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Analytics View -->
        <div id="analytics-view" class="admin-view">
            <div class="admin-header">
                <h1>Analytics</h1>
                <div class="admin-actions">
                    <button class="btn btn-secondary" onclick="exportAnalytics()">
                        <i class="fas fa-download"></i> Export Report
                    </button>
                </div>
            </div>

            <div class="analytics-grid">
                <div class="analytics-card">
                    <h3>Traffic Overview</h3>
                    <canvas id="traffic-chart"></canvas>
                </div>
                <div class="analytics-card">
                    <h3>Popular APKs</h3>
                    <div id="popular-apks-list"></div>
                </div>
                <div class="analytics-card">
                    <h3>User Engagement</h3>
                    <canvas id="engagement-chart"></canvas>
                </div>
                <div class="analytics-card">
                    <h3>Revenue Tracking</h3>
                    <canvas id="revenue-chart"></canvas>
                </div>
            </div>
        </div>

        <!-- Settings View -->
        <div id="settings-view" class="admin-view">
            <div class="admin-header">
                <h1>Settings</h1>
                <div class="admin-actions">
                    <button class="btn btn-primary" onclick="saveSettings()">
                        <i class="fas fa-save"></i> Save Settings
                    </button>
                </div>
            </div>

            <div class="settings-grid">
                <div class="settings-card">
                    <h3>General Settings</h3>
                    <form id="general-settings">
                        <div class="form-group">
                            <label>Site Title</label>
                            <input type="text" name="site_title" value="ModAPK Platform">
                        </div>
                        <div class="form-group">
                            <label>Site Description</label>
                            <textarea name="site_description" rows="3">Download premium modded APKs</textarea>
                        </div>
                        <div class="form-group">
                            <label>Admin Email</label>
                            <input type="email" name="admin_email" value="admin@modapk.com">
                        </div>
                    </form>
                </div>

                <div class="settings-card">
                    <h3>App Settings</h3>
                    <form id="app-settings">
                        <div class="form-group">
                            <label>
                                <input type="checkbox" name="allow_registration">
                                Allow User Registration
                            </label>
                        </div>
                        <div class="form-group">
                            <label>
                                <input type="checkbox" name="require_approval">
                                Require APK Approval
                            </label>
                        </div>
                        <div class="form-group">
                            <label>
                                <input type="checkbox" name="enable_ratings">
                                Enable Ratings & Reviews
                            </label>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </main>

    <!-- Modals -->
    
    <!-- Add APK Modal -->
    <div id="add-apk-modal" class="modal">
        <div class="modal-content large-modal">
            <div class="modal-header">
                <h3>Add New APK</h3>
                <button class="close-modal" onclick="closeModal('add-apk-modal')">&times;</button>
            </div>
            <div class="modal-body">
                <form id="add-apk-form" class="admin-form">
                    <div class="form-row">
                        <div class="form-group">
                            <label>APK Name *</label>
                            <input type="text" name="name" required>
                        </div>
                        <div class="form-group">
                            <label>Version *</label>
                            <input type="text" name="version" required>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>Package Name *</label>
                            <input type="text" name="package_name" required>
                        </div>
                        <div class="form-group">
                            <label>Category *</label>
                            <select name="category" id="add-apk-category" required>
                                <!-- Categories will be loaded here -->
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label>Description</label>
                        <textarea name="description" rows="4"></textarea>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>Download URL *</label>
                            <input type="url" name="download_url" required>
                        </div>
                        <div class="form-group">
                            <label>Icon URL</label>
                            <input type="url" name="icon_url">
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>File Size</label>
                            <input type="text" name="file_size" placeholder="e.g., 25.6 MB">
                        </div>
                        <div class="form-group">
                            <label>Android Version</label>
                            <input type="text" name="android_version" placeholder="e.g., 5.0+">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label>Features (comma-separated)</label>
                        <input type="text" name="features" placeholder="Ad-free, Premium features, etc.">
                    </div>
                    
                    <div class="form-group">
                        <label>Tags (comma-separated)</label>
                        <input type="text" name="tags" placeholder="social, messaging, premium">
                    </div>
                    
                    <div class="form-checkboxes">
                        <label><input type="checkbox" name="verified"> Verified</label>
                        <label><input type="checkbox" name="featured"> Featured</label>
                        <label><input type="checkbox" name="trending"> Trending</label>
                    </div>
                    
                    <div class="form-actions">
                        <button type="button" onclick="closeModal('add-apk-modal')" class="btn btn-secondary">Cancel</button>
                        <button type="submit" class="btn btn-primary">Add APK</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Add Category Modal -->
    <div id="add-category-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Add New Category</h3>
                <button class="close-modal" onclick="closeModal('add-category-modal')">&times;</button>
            </div>
            <div class="modal-body">
                <form id="add-category-form" class="admin-form">
                    <div class="form-group">
                        <label>Category Name *</label>
                        <input type="text" name="name" required>
                    </div>
                    <div class="form-group">
                        <label>Description</label>
                        <textarea name="description" rows="3"></textarea>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Icon (FontAwesome class)</label>
                            <input type="text" name="icon" placeholder="fas fa-folder">
                        </div>
                        <div class="form-group">
                            <label>Color</label>
                            <input type="color" name="color" value="#1FB8CD">
                        </div>
                    </div>
                    <div class="form-actions">
                        <button type="button" onclick="closeModal('add-category-modal')" class="btn btn-secondary">Cancel</button>
                        <button type="submit" class="btn btn-primary">Add Category</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Add Advertisement Modal -->
    <div id="add-ad-modal" class="modal">
        <div class="modal-content large-modal">
            <div class="modal-header">
                <h3>Create Advertisement</h3>
                <button class="close-modal" onclick="closeModal('add-ad-modal')">&times;</button>
            </div>
            <div class="modal-body">
                <form id="add-ad-form" class="admin-form">
                    <div class="form-row">
                        <div class="form-group">
                            <label>Ad Title *</label>
                            <input type="text" name="title" required>
                        </div>
                        <div class="form-group">
                            <label>Position *</label>
                            <select name="position" required>
                                <option value="top">Top Banner</option>
                                <option value="middle">Middle Banner</option>
                                <option value="bottom">Bottom Banner</option>
                                <option value="sidebar">Sidebar</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label>Ad Content (HTML) *</label>
                        <textarea name="content" rows="6" required placeholder="<img src='ad-image.jpg' alt='Advertisement' style='width: 100%; height: auto;'>"></textarea>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>Target URL</label>
                            <input type="url" name="target_url" placeholder="https://example.com">
                        </div>
                        <div class="form-group">
                            <label>
                                <input type="checkbox" name="active" checked>
                                Active
                            </label>
                        </div>
                    </div>
                    
                    <div class="form-actions">
                        <button type="button" onclick="closeModal('add-ad-modal')" class="btn btn-secondary">Cancel</button>
                        <button type="submit" class="btn btn-primary">Create Ad</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- File Upload Area -->
    <div id="file-upload-area" class="file-upload-area" style="display: none;">
        <div class="upload-content">
            <i class="fas fa-cloud-upload-alt"></i>
            <h3>Drag & Drop APK File</h3>
            <p>Or click to browse</p>
            <input type="file" id="file-input" accept=".apk,.xapk" style="display: none;">
        </div>
        <div class="upload-progress" id="upload-progress" style="display: none;">
            <div class="progress-bar">
                <div class="progress-fill" id="progress-fill"></div>
            </div>
            <p id="progress-text">Uploading... 0%</p>
        </div>
    </div>

    <!-- Toast Container -->
    <div id="toast-container" class="toast-container"></div>

    <!-- JavaScript -->
    <script src="admin.js"></script>
</body>
</html>